(function(c,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(c=typeof globalThis<"u"?globalThis:c||self,r(c["vue3-flow"]={},c.Vue))})(this,function(c,r){"use strict";function h(e,n,o){if(typeof o=="string")return n.value=o,n.value;const i=Object.keys(e),f=i.indexOf(n.value);f+1<i.length&&(n.value=i[f+1])}function _(e,n,o){if(n in e)throw new Error(`Node "${n}" is already exist`);if(e[n]={},!("component"in o))throw new Error(`Field "component" of "${n}" is not defined`);if(typeof o.component=="function")e[n].component=r.markRaw(r.defineAsyncComponent(o.component));else if(typeof o.component.render=="function")e[n].component=o.component;else throw new Error(`Field "component" of "${n}" must be function or object`);e[n].props="props"in o?o.props:{},e[n].events="events"in o?o.events:{},e[n].show="show"in o?o.show:!0,e[n].type="page"}function y(e,n,o){if(n in e)throw new Error(`Node "${n}" is already exist`);if(e[n]={},e[n].props="props"in o?o.props:{},!("flow"in o))throw new Error(`Field "flow" of "${n}" is not defined`);if(typeof o.flow=="function")e[n].props={...e[n].props,flow:o.flow};else throw new Error(`Field "flow" of "${n}" must be function`);e[n].component=r.markRaw(r.defineAsyncComponent(()=>Promise.resolve().then(()=>m))),e[n].events="events"in o?o.events:{},e[n].show="show"in o?o.show:!0,e[n].type="flow"}const d=Object.assign({inheritAttrs:!1},{__name:"FlowPage",props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){const n=e,o={onBeforeMount:[],onBeforeUpdate:[],onBeforeUnmount:[],onMounted:[],onUpdated:[],onUnmounted:[]},i=r.reactive({}),f=r.ref(null),u={nodes:i,get:()=>f.value,next:t=>h(i,f,t),addPage:(t,l)=>_(i,t,l),addFlow:(t,l)=>y(i,t,l),store:r.reactive({}),props:r.useAttrs(),onBeforeMount:t=>{o.onBeforeMount.push(t)},onBeforeUpdate:t=>{o.onBeforeUpdate.push(t)},onBeforeUnmount:t=>{o.onBeforeUnmount.push(t)},onMounted:t=>{o.onMounted.push(t)},onUpdated:t=>{o.onUpdated.push(t)},onUnmounted:t=>{o.onUnmounted.push(t)}};"__before__"in n.hooks&&n.hooks.__before__(u),n.flow(u),"__after__"in n.hooks&&n.hooks.__after__(u),r.onBeforeMount(async()=>{o.onBeforeMount.forEach(async t=>await t())}),r.onBeforeUpdate(async()=>{o.onBeforeUpdate.forEach(async t=>await t())}),r.onBeforeUnmount(async()=>{o.onBeforeUnmount.forEach(async t=>await t())}),r.onMounted(async()=>{o.onMounted.forEach(async t=>await t())}),r.onUpdated(async()=>{o.onUpdated.forEach(async t=>await t())}),r.onUnmounted(async()=>{o.onUnmounted.forEach(async t=>await t())}),f.value=Object.keys(i)[0];const s=r.computed(()=>i[f.value]);return(t,l)=>r.unref(s).show?(r.openBlock(),r.createBlock(r.resolveDynamicComponent(r.unref(s).component),r.mergeProps({key:0},r.unref(s).props,r.toHandlers(r.unref(s).events)),null,16)):r.createCommentVNode("",!0)}}),m=Object.freeze(Object.defineProperty({__proto__:null,default:d},Symbol.toStringTag,{value:"Module"}));function p(e){return e.search(/__(.+)__/)>=0}function a(e,n){return Object.fromEntries(Object.entries(e).filter(n))}function w(e){const n=a(Object.values(e.main)[0],([s])=>!p(s)),o=a(Object.values(e.main)[0],([s])=>p(s)),i=e.root===void 0||e.root===null||e.root===!0?!0:e.root,f=e.children,u=[];return Object.entries(n).forEach(([s,t])=>{u.push({path:i?`/${s}`:s,name:s,props:{flow:t,hooks:o},component:d}),f&&(u.at(-1).children=w({...f,root:!1}))}),u}function E(e){return(n,...o)=>{if(!Object.keys(e).includes(n))throw new Error(`Called action "${n}" is not defined`);return e[n](...o)}}function U(e){return()=>{const n=r.getCurrentInstance();return(o,...i)=>{if(!Object.keys(e).includes(o))throw new Error(`Called event "${o}" is not defined`);Object.values(e).forEach(f=>{if(!f(...i))throw new Error(`Emitted event "${o}" is not valid`)}),n.emit(o,...i)}}}function g(){return r.getCurrentInstance().emit}c.defineAction=E,c.defineEmit=U,c.getEmit=g,c.registerFlowTree=w,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
