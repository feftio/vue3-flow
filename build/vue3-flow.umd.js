(function(c,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],n):(c=typeof globalThis<"u"?globalThis:c||self,n(c["vue3-flow"]={},c.Vue))})(this,function(c,n){"use strict";function p(e){return Object.prototype.toString.call(e)==="[object Object]"}function d(e){return typeof e=="boolean"}function O(e,o){const t={};if(!("component"in o))throw new Error(`Option "component" of "${e}" node is not defined`);if(typeof o.component=="function")t.component=n.markRaw(n.defineAsyncComponent(o.component));else if(typeof o.component.render=="function"||typeof o.component.setup=="function")t.component=n.markRaw(o.component);else throw new Error(`Option "component" of "${e}" node must be function or object`);return t.props=p(o.props)?o.props:{},t.events=p(o.events)?o.events:{},t.show=d(o.show)?o.show:!0,t.type="page",t}function j(e,o){const t={};if(t.props=p(o.props)?o.props:{},!("flow"in o))throw new Error(`Option "flow" of "${e}" node is not defined`);if(typeof o.flow=="function")t.props={...t.props,flow:o.flow};else throw new Error(`Option "flow" of "${e}" node must be function`);return t.component=n.markRaw(n.defineAsyncComponent(()=>Promise.resolve().then(()=>P))),t.events=p(o.events)?o.events:{},t.show=d(o.show)?o.show:!0,t.type="flow",t}function k(e){if(e.type!=="page")throw new Error('Node type must be "page" for NodeToPage transformation');return{component:e.component,props:e.props,events:e.events,show:e.show}}function E(e){if(e.type!=="flow")throw new Error('Node type must be "flow" for NodeToFlow transformation');const o=e.props.flow;return delete e.props.flow,{flow:o,props:e.props,events:e.events,show:e.show}}function F(e){return{component:e.component,props:e.props,events:e.events,show:e.show}}function v(e){return{props:{...e.props,flow:e.flow},events:e.events,show:e.show}}function a(e,o,t){if(typeof t=="string"&&!(t in e))throw new Error(`Node "${t}" is not defined`);if(typeof t=="string"&&t in e)return o.value=t,o.value;const r=Object.keys(e),s=r.indexOf(o.value);s+1<r.length&&(o.value=r[s+1])}function h(e,o,t){if(o in e)throw new Error(`Node "${o}" is already exist`);return e[o]=O(o,t),e[o]}function _(e,o,t){if(o in e)throw new Error(`Node "${o}" is already exist`);return e[o]=j(o,t),e[o]}function y(e,o,t){if(!(o in e))throw new Error(`Node "${o}" is not exist`);let r;const s=e[o];if(s.type==="page")r=t(k(s)),Object.assign(s,F(r));else if(s.type==="flow")r=t(E(s)),Object.assign(s,v(r));else throw new Error(`Node type "${s.type}" is invalid`);return s}const w=Object.assign({inheritAttrs:!1},{__name:"FlowPage",props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){var i;const o=e,t=n.reactive({}),r=n.ref(null),s={nodes:t,current:()=>r.value,next:f=>a(t,r,f),addPage:(f,u)=>h(t,f,u),addFlow:(f,u)=>_(t,f,u),modify:(f,u)=>y(t,f,u),store:n.reactive({}),props:n.useAttrs()};"__before__"in o.hooks&&o.hooks.__before__(s),o.flow(s),"__after__"in o.hooks&&o.hooks.__after__(s),(i=r.value)!=null||(r.value=Object.keys(t)[0]);const l=n.computed(()=>t[r.value]);return(f,u)=>n.unref(l).show?(n.openBlock(),n.createBlock(n.resolveDynamicComponent(n.unref(l).component),n.mergeProps({key:0},n.unref(l).props,n.toHandlers(n.unref(l).events)),null,16)):n.createCommentVNode("",!0)}}),P=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"})),N={name:"FlowView",props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){return()=>n.h(w,{flow:e.flow,hooks:e.hooks})}},$={inheritAttrs:!1,props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){var l;const o=n.reactive({}),t=n.ref(null),r={nodes:o,current:()=>t.value,next:i=>a(o,t,i),addPage:(i,f)=>h(o,i,f),addFlow:(i,f)=>_(o,i,f),modify:(i,f)=>y(o,i,f),store:n.reactive({}),props:n.useAttrs()};"__before__"in e.hooks&&e.hooks.__before__(r),e.flow(r),"__after__"in e.hooks&&e.hooks.__after__(r),(l=t.value)!=null||(t.value=Object.keys(o)[0]);const s=n.computed(()=>o[t.value]);return()=>n.h(s.value.component,{...s.value.props,...s.value.events})}};function m(e){return e.search(/__(.+)__/)>=0}function b(e,o){return Object.fromEntries(Object.entries(e).filter(o))}function g(e){const o=b(Object.values(e.main)[0],([i])=>!m(i)),t=b(Object.values(e.main)[0],([i])=>m(i)),r=e.root===void 0||e.root===null||e.root===!0?!0:e.root,s=e.children,l=[];return Object.entries(o).forEach(([i,f])=>{l.push({path:r?`/${i}`:i,name:i,props:{flow:f,hooks:t},component:w}),s&&(l.at(-1).children=g({...s,root:!1}))}),l}function T(e){return(o,...t)=>{if(!Object.keys(e).includes(o))throw new Error(`Called action "${o}" is not defined`);return e[o](...t)}}function A(e){return()=>{const o=n.getCurrentInstance();return(t,...r)=>{if(!Object.keys(e).includes(t))throw new Error(`Called event "${t}" is not defined`);Object.values(e).forEach(s=>{if(!s(...r))throw new Error(`Emitted event "${t}" is not valid`)}),o.emit(t,...r)}}}function C(){return n.getCurrentInstance().emit}c.FlowPage=$,c.FlowPageVue=w,c.FlowView=N,c.defineAction=T,c.defineEmit=A,c.getEmit=C,c.registerFlowTree=g,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
