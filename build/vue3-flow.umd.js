(function(a,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(a=typeof globalThis<"u"?globalThis:a||self,t(a["vue3-flow"]={},a.Vue))})(this,function(a,t){"use strict";function l(e,o,n){if(typeof n=="string")return o.value=n,o.value;const f=Object.keys(e),i=f.indexOf(o.value);i+1<f.length&&(o.value=f[i+1])}function p(e,o,n){if(o in e)throw new Error(`Node "${o}" is already exist`);if(e[o]={},!("component"in n))throw new Error(`Field "component" of "${o}" is not defined`);if(typeof n.component=="function")e[o].component=t.markRaw(t.defineAsyncComponent(n.component));else if(typeof n.component.render=="function")e[o].component=t.markRaw(n.component);else throw new Error(`Field "component" of "${o}" must be function or object`);e[o].props="props"in n?n.props:{},e[o].events="events"in n?n.events:{},e[o].show="show"in n?n.show:!0,e[o].type="page"}function h(e,o,n){if(o in e)throw new Error(`Node "${o}" is already exist`);if(e[o]={},e[o].props="props"in n?n.props:{},!("flow"in n))throw new Error(`Field "flow" of "${o}" is not defined`);if(typeof n.flow=="function")e[o].props={...e[o].props,flow:n.flow};else throw new Error(`Field "flow" of "${o}" must be function`);e[o].component=t.markRaw(t.defineAsyncComponent(()=>Promise.resolve().then(()=>m))),e[o].events="events"in n?n.events:{},e[o].show="show"in n?n.show:!0,e[o].type="flow"}const d=Object.assign({inheritAttrs:!1},{__name:"FlowPage",props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){const o=e,n={onBeforeMount:[],onBeforeUpdate:[],onBeforeUnmount:[],onMounted:[],onUpdated:[],onUnmounted:[]},f=t.reactive({}),i=t.ref(null),c={nodes:f,get:()=>i.value,next:s=>l(f,i,s),addPage:(s,u)=>p(f,s,u),addFlow:(s,u)=>h(f,s,u),store:t.reactive({}),props:t.useAttrs(),onBeforeMount:s=>{n.onBeforeMount.push(s)},onBeforeUpdate:s=>{n.onBeforeUpdate.push(s)},onBeforeUnmount:s=>{n.onBeforeUnmount.push(s)},onMounted:s=>{n.onMounted.push(s)},onUpdated:s=>{n.onUpdated.push(s)},onUnmounted:s=>{n.onUnmounted.push(s)}};"__before__"in o.hooks&&o.hooks.__before__(c),o.flow(c),"__after__"in o.hooks&&o.hooks.__after__(c),t.onBeforeMount(async()=>{n.onBeforeMount.forEach(async s=>await s())}),t.onBeforeUpdate(async()=>{n.onBeforeUpdate.forEach(async s=>await s())}),t.onBeforeUnmount(async()=>{n.onBeforeUnmount.forEach(async s=>await s())}),t.onMounted(async()=>{n.onMounted.forEach(async s=>await s())}),t.onUpdated(async()=>{n.onUpdated.forEach(async s=>await s())}),t.onUnmounted(async()=>{n.onUnmounted.forEach(async s=>await s())}),i.value=Object.keys(f)[0];const r=t.computed(()=>f[i.value]);return(s,u)=>t.unref(r).show?(t.openBlock(),t.createBlock(t.resolveDynamicComponent(t.unref(r).component),t.mergeProps({key:0},t.unref(r).props,t.toHandlers(t.unref(r).events)),null,16)):t.createCommentVNode("",!0)}}),m=Object.freeze(Object.defineProperty({__proto__:null,default:d},Symbol.toStringTag,{value:"Module"})),U={name:"FlowView",props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){return()=>t.h(d,{flow:e.flow,hooks:e.hooks})}},B={inheritAttrs:!1,props:{flow:{type:Function,required:!0},hooks:{type:Object,default(){return{}}}},setup(e){const o={onBeforeMount:[],onBeforeUpdate:[],onBeforeUnmount:[],onMounted:[],onUpdated:[],onUnmounted:[]},n=t.reactive({}),f=t.ref(null),i={nodes:n,get:()=>f.value,next:r=>l(n,f,r),addPage:(r,s)=>p(n,r,s),addFlow:(r,s)=>h(n,r,s),store:t.reactive({}),props:t.useAttrs(),onBeforeMount:r=>{o.onBeforeMount.push(r)},onBeforeUpdate:r=>{o.onBeforeUpdate.push(r)},onBeforeUnmount:r=>{o.onBeforeUnmount.push(r)},onMounted:r=>{o.onMounted.push(r)},onUpdated:r=>{o.onUpdated.push(r)},onUnmounted:r=>{o.onUnmounted.push(r)}};"__before__"in e.hooks&&e.hooks.__before__(i),e.flow(i),"__after__"in e.hooks&&e.hooks.__after__(i),t.onBeforeMount(async()=>{o.onBeforeMount.forEach(async r=>await r())}),t.onBeforeUpdate(async()=>{o.onBeforeUpdate.forEach(async r=>await r())}),t.onBeforeUnmount(async()=>{o.onBeforeUnmount.forEach(async r=>await r())}),t.onMounted(async()=>{o.onMounted.forEach(async r=>await r())}),t.onUpdated(async()=>{o.onUpdated.forEach(async r=>await r())}),t.onUnmounted(async()=>{o.onUnmounted.forEach(async r=>await r())}),f.value=Object.keys(n)[0];const c=t.computed(()=>n[f.value]);return()=>t.h(c.value.component,{...c.value.props,...c.value.events})}};function w(e){return e.search(/__(.+)__/)>=0}function _(e,o){return Object.fromEntries(Object.entries(e).filter(o))}function y(e){const o=_(Object.values(e.main)[0],([r])=>!w(r)),n=_(Object.values(e.main)[0],([r])=>w(r)),f=e.root===void 0||e.root===null||e.root===!0?!0:e.root,i=e.children,c=[];return Object.entries(o).forEach(([r,s])=>{c.push({path:f?`/${r}`:r,name:r,props:{flow:s,hooks:n},component:d}),i&&(c.at(-1).children=y({...i,root:!1}))}),c}function E(e){return(o,...n)=>{if(!Object.keys(e).includes(o))throw new Error(`Called action "${o}" is not defined`);return e[o](...n)}}function k(e){return()=>{const o=t.getCurrentInstance();return(n,...f)=>{if(!Object.keys(e).includes(n))throw new Error(`Called event "${n}" is not defined`);Object.values(e).forEach(i=>{if(!i(...f))throw new Error(`Emitted event "${n}" is not valid`)}),o.emit(n,...f)}}}function M(){return t.getCurrentInstance().emit}a.FlowPage=B,a.FlowView=U,a.defineAction=E,a.defineEmit=k,a.getEmit=M,a.registerFlowTree=y,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
